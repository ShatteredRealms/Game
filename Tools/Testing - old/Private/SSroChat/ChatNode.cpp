//Generated by TurboLink CodeGenerator, do not edit!
#include "SSroChat/ChatNode.h"
#include "SSroChat/ChatService.h"
#include "TurboLinkGrpcManager.h"
#include "TurboLinkGrpcUtilities.h"

UCallChatServiceSendChatMessage* UCallChatServiceSendChatMessage::SendChatMessage(UObject* WorldContextObject, const FGrpcSroChatSendChatMessageRequest& Request)
{
	UCallChatServiceSendChatMessage* node = NewObject<UCallChatServiceSendChatMessage>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceSendChatMessage::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceSendChatMessage::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcGoogleProtobufEmpty response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceSendChatMessage::OnContextStateChange);
		ChatServiceClient->OnSendChatMessageResponse.AddUniqueDynamic(this, &UCallChatServiceSendChatMessage::OnResponse);

		Context = ChatServiceClient->InitSendChatMessage();
		ChatServiceClient->SendChatMessage(Context, Request);
	}
}

void UCallChatServiceSendChatMessage::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceSendChatMessage::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcGoogleProtobufEmpty& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceSendChatMessage::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceSendChatMessage::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}

UCallChatServiceSendDirectMessage* UCallChatServiceSendDirectMessage::SendDirectMessage(UObject* WorldContextObject, const FGrpcSroChatSendDirectMessageRequest& Request)
{
	UCallChatServiceSendDirectMessage* node = NewObject<UCallChatServiceSendDirectMessage>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceSendDirectMessage::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceSendDirectMessage::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcGoogleProtobufEmpty response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceSendDirectMessage::OnContextStateChange);
		ChatServiceClient->OnSendDirectMessageResponse.AddUniqueDynamic(this, &UCallChatServiceSendDirectMessage::OnResponse);

		Context = ChatServiceClient->InitSendDirectMessage();
		ChatServiceClient->SendDirectMessage(Context, Request);
	}
}

void UCallChatServiceSendDirectMessage::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceSendDirectMessage::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcGoogleProtobufEmpty& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceSendDirectMessage::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceSendDirectMessage::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}

UCallChatServiceGetChannel* UCallChatServiceGetChannel::GetChannel(UObject* WorldContextObject, const FGrpcSroChatChatChannelTarget& Request)
{
	UCallChatServiceGetChannel* node = NewObject<UCallChatServiceGetChannel>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceGetChannel::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceGetChannel::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcSroChatChatChannel response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceGetChannel::OnContextStateChange);
		ChatServiceClient->OnGetChannelResponse.AddUniqueDynamic(this, &UCallChatServiceGetChannel::OnResponse);

		Context = ChatServiceClient->InitGetChannel();
		ChatServiceClient->GetChannel(Context, Request);
	}
}

void UCallChatServiceGetChannel::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceGetChannel::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcSroChatChatChannel& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceGetChannel::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceGetChannel::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}

UCallChatServiceAllChatChannels* UCallChatServiceAllChatChannels::AllChatChannels(UObject* WorldContextObject, const FGrpcGoogleProtobufEmpty& Request)
{
	UCallChatServiceAllChatChannels* node = NewObject<UCallChatServiceAllChatChannels>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceAllChatChannels::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceAllChatChannels::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcSroChatChatChannels response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceAllChatChannels::OnContextStateChange);
		ChatServiceClient->OnAllChatChannelsResponse.AddUniqueDynamic(this, &UCallChatServiceAllChatChannels::OnResponse);

		Context = ChatServiceClient->InitAllChatChannels();
		ChatServiceClient->AllChatChannels(Context, Request);
	}
}

void UCallChatServiceAllChatChannels::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceAllChatChannels::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcSroChatChatChannels& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceAllChatChannels::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceAllChatChannels::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}

UCallChatServiceCreateChannel* UCallChatServiceCreateChannel::CreateChannel(UObject* WorldContextObject, const FGrpcSroChatCreateChannelMessage& Request)
{
	UCallChatServiceCreateChannel* node = NewObject<UCallChatServiceCreateChannel>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceCreateChannel::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceCreateChannel::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcGoogleProtobufEmpty response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceCreateChannel::OnContextStateChange);
		ChatServiceClient->OnCreateChannelResponse.AddUniqueDynamic(this, &UCallChatServiceCreateChannel::OnResponse);

		Context = ChatServiceClient->InitCreateChannel();
		ChatServiceClient->CreateChannel(Context, Request);
	}
}

void UCallChatServiceCreateChannel::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceCreateChannel::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcGoogleProtobufEmpty& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceCreateChannel::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceCreateChannel::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}

UCallChatServiceDeleteChannel* UCallChatServiceDeleteChannel::DeleteChannel(UObject* WorldContextObject, const FGrpcSroChatChatChannelTarget& Request)
{
	UCallChatServiceDeleteChannel* node = NewObject<UCallChatServiceDeleteChannel>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceDeleteChannel::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceDeleteChannel::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcGoogleProtobufEmpty response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceDeleteChannel::OnContextStateChange);
		ChatServiceClient->OnDeleteChannelResponse.AddUniqueDynamic(this, &UCallChatServiceDeleteChannel::OnResponse);

		Context = ChatServiceClient->InitDeleteChannel();
		ChatServiceClient->DeleteChannel(Context, Request);
	}
}

void UCallChatServiceDeleteChannel::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceDeleteChannel::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcGoogleProtobufEmpty& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceDeleteChannel::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceDeleteChannel::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}

UCallChatServiceEditChannel* UCallChatServiceEditChannel::EditChannel(UObject* WorldContextObject, const FGrpcSroChatUpdateChatChannelRequest& Request)
{
	UCallChatServiceEditChannel* node = NewObject<UCallChatServiceEditChannel>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceEditChannel::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceEditChannel::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcGoogleProtobufEmpty response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceEditChannel::OnContextStateChange);
		ChatServiceClient->OnEditChannelResponse.AddUniqueDynamic(this, &UCallChatServiceEditChannel::OnResponse);

		Context = ChatServiceClient->InitEditChannel();
		ChatServiceClient->EditChannel(Context, Request);
	}
}

void UCallChatServiceEditChannel::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceEditChannel::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcGoogleProtobufEmpty& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceEditChannel::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceEditChannel::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}

UCallChatServiceGetAuthorizedChatChannels* UCallChatServiceGetAuthorizedChatChannels::GetAuthorizedChatChannels(UObject* WorldContextObject, const FGrpcSroCharactersCharacterTarget& Request)
{
	UCallChatServiceGetAuthorizedChatChannels* node = NewObject<UCallChatServiceGetAuthorizedChatChannels>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceGetAuthorizedChatChannels::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceGetAuthorizedChatChannels::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcSroChatChatChannels response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceGetAuthorizedChatChannels::OnContextStateChange);
		ChatServiceClient->OnGetAuthorizedChatChannelsResponse.AddUniqueDynamic(this, &UCallChatServiceGetAuthorizedChatChannels::OnResponse);

		Context = ChatServiceClient->InitGetAuthorizedChatChannels();
		ChatServiceClient->GetAuthorizedChatChannels(Context, Request);
	}
}

void UCallChatServiceGetAuthorizedChatChannels::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceGetAuthorizedChatChannels::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcSroChatChatChannels& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceGetAuthorizedChatChannels::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceGetAuthorizedChatChannels::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}

UCallChatServiceUpdateUserChatChannelAuthorizations* UCallChatServiceUpdateUserChatChannelAuthorizations::UpdateUserChatChannelAuthorizations(UObject* WorldContextObject, const FGrpcSroChatRequestChatChannelAuthChange& Request)
{
	UCallChatServiceUpdateUserChatChannelAuthorizations* node = NewObject<UCallChatServiceUpdateUserChatChannelAuthorizations>(WorldContextObject);
	UTurboLinkGrpcManager* turboLinkManager = UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(WorldContextObject);

	node->ChatService = Cast<UChatService>(turboLinkManager->MakeService("ChatService"));
	if (node->ChatService == nullptr)
	{
		return nullptr;
	}
	node->Request = Request;

	node->ChatService->OnServiceStateChanged.AddUniqueDynamic(node, &UCallChatServiceUpdateUserChatChannelAuthorizations::OnServiceStateChanged);
	WorldContextObject->GetWorld()->GetTimerManager().SetTimerForNextTick(FTimerDelegate::CreateLambda([node]() {
		node->ChatService->Connect();
	}));
	return node;
}

void UCallChatServiceUpdateUserChatChannelAuthorizations::OnServiceStateChanged(EGrpcServiceState NewState)
{
	if (NewState == EGrpcServiceState::TransientFailure)
	{
		FGrpcResult result;
		result.Code = EGrpcResultCode::ConnectionFailed;

		FGrpcGoogleProtobufEmpty response;
		OnFail.Broadcast(result, response);

		Shutdown();
		return;
	}

	if (NewState == EGrpcServiceState::Ready)
	{
		ChatServiceClient = ChatService->MakeClient();
		ChatServiceClient->OnContextStateChange.AddUniqueDynamic(this, &UCallChatServiceUpdateUserChatChannelAuthorizations::OnContextStateChange);
		ChatServiceClient->OnUpdateUserChatChannelAuthorizationsResponse.AddUniqueDynamic(this, &UCallChatServiceUpdateUserChatChannelAuthorizations::OnResponse);

		Context = ChatServiceClient->InitUpdateUserChatChannelAuthorizations();
		ChatServiceClient->UpdateUserChatChannelAuthorizations(Context, Request);
	}
}

void UCallChatServiceUpdateUserChatChannelAuthorizations::OnContextStateChange(FGrpcContextHandle Handle, EGrpcContextState State)
{
	if (State == EGrpcContextState::Done)
	{
		Shutdown();
	}
}

void UCallChatServiceUpdateUserChatChannelAuthorizations::OnResponse(FGrpcContextHandle Handle, const FGrpcResult& GrpcResult, const FGrpcGoogleProtobufEmpty& Response)
{
	if (GrpcResult.Code == EGrpcResultCode::Ok)
	{
		OnSuccess.Broadcast(GrpcResult, Response);
	}
	else
	{
		OnFail.Broadcast(GrpcResult, Response);
	}
}

void UCallChatServiceUpdateUserChatChannelAuthorizations::Shutdown()
{
	ChatService->OnServiceStateChanged.RemoveDynamic(this, &UCallChatServiceUpdateUserChatChannelAuthorizations::OnServiceStateChanged);
	if (ChatServiceClient != nullptr)
	{
		ChatService->RemoveClient(ChatServiceClient);
		ChatServiceClient->Shutdown();
		ChatServiceClient = nullptr;
	}

	if (ChatService != nullptr)
	{
		UTurboLinkGrpcUtilities::GetTurboLinkGrpcManager(this)->ReleaseService(ChatService);
		ChatService = nullptr;
	}

	SetReadyToDestroy();
#if ENGINE_MAJOR_VERSION>=5
	MarkAsGarbage();
#else
	MarkPendingKill();
#endif
}
